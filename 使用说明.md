# WebSocket动态数据模拟器 使用说明

## 项目概述

这是一个基于Spring Boot的WebSocket动态数据模拟器，支持智能数据类型识别和交互式模板编辑。项目采用高内聚低耦合的设计原则，支持多客户端连接、实时数据推送和动态JSON模板配置。

## 快速开始

### 1. 环境要求
- **JDK**: 1.8
- **Maven**: 3.6.2
- **端口**: 1883

### 2. 启动服务

#### 方法一：使用批处理脚本（推荐）
```bash
# 双击运行
start.bat
```

#### 方法二：使用Maven命令
```bash
# Windows PowerShell
.\mvnw.cmd spring-boot:run

# 或者
mvn spring-boot:run
```

#### 方法三：使用Java命令
```bash
# 先打包
.\mvnw.cmd clean package -DskipTests

# 再运行
java -jar target/kinetic-simulator-WebSocker-0.0.1-SNAPSHOT.jar
```

### 3. 验证服务启动
服务启动成功后，您应该看到类似以下的日志：
```
2024-XX-XX XX:XX:XX.XXX  INFO 1234 --- [main] c.e.k.KineticSimulatorWebSockerApplication : Started KineticSimulatorWebSockerApplication in X.XXX seconds (JVM running for X.XXX)
```

## 使用Web界面

### 1. 访问测试页面
启动服务后，打开浏览器访问：`http://localhost:1883/test-client.html`

### 2. 界面功能说明

#### 连接控制区域
- **连接按钮**: 建立WebSocket连接
- **断开按钮**: 断开WebSocket连接
- **清空日志**: 清除日志显示
- **刷新连接数**: 手动更新当前连接数显示

#### 模板编辑器区域
- **JSON输入框**: 输入JSON格式的模板
- **解析并编辑**: 解析JSON模板并显示字段配置界面
- **生成示例模板**: 自动生成示例模板
- **清空模板**: 清除当前模板

#### 字段类型配置
解析模板后，会显示每个字段的配置选项：
- **字段路径**: 显示字段的完整路径（如 `user_id`, `location.latitude`）
- **类型选择**: 下拉菜单选择数据类型
- **字段值**: 显示字段的当前值
- **限制设置**: 数字和日期类型可设置最大值最小值

#### 数据预览区域
- 实时显示后端推送的数据
- 支持JSON格式化显示

#### 日志区域
- 显示连接状态、消息收发等日志信息
- 不同颜色区分不同类型的日志

## 模板编辑流程

### 1. 输入JSON模板
在"输入JSON模板"文本框中输入JSON格式的模板，例如：
```json
{
  "user_id": 0,
  "user_name": "",
  "age": 0,
  "email": "",
  "is_active": false,
  "score": 0.0,
  "location": {
    "latitude": 0.0,
    "longitude": 0.0
  }
}
```

### 2. 解析并编辑
点击"解析并编辑"按钮，系统会：
- 解析JSON模板
- 自动识别字段类型
- 显示字段配置界面

### 3. 配置字段类型
为每个字段选择合适的数据类型：
- **基础类型**: string, int, double, boolean, array, object
- **特殊格式**: email, phone, date, ip, url, uuid, name, color
- **范围限制类型**: age, year, month, day, hour, minute, second, port, id, price, rate, score, temperature, latitude, longitude

### 4. 设置字段限制（可选）
对于数字类型和日期类型，可以设置最大值最小值：
- **最小值**: 输入字段的最小值
- **最大值**: 输入字段的最大值
- 留空则使用默认范围

### 5. 应用模板
点击"应用模板"按钮：
- 将配置发送到后端
- 开始接收根据配置生成的随机数据
- 每5秒自动推送新数据

## 支持的数据类型

### 基础类型
- `string` - 字符串
- `int` - 整数
- `double` - 浮点数
- `boolean` - 布尔值
- `array` - 数组
- `object` - 对象

### 特殊格式
- `email` - 邮箱地址
- `phone` - 手机号码
- `date` - 日期时间
- `ip` - IP地址
- `url` - URL地址
- `uuid` - UUID标识符
- `name` - 中文姓名
- `color` - 颜色名称

### 范围限制类型
- `age` - 年龄 (1-100)
- `year` - 年份 (2000-2024)
- `month` - 月份 (1-12)
- `day` - 日期 (1-31)
- `hour` - 小时 (0-23)
- `minute` - 分钟 (0-59)
- `second` - 秒 (0-59)
- `port` - 端口 (1024-65535)
- `id` - ID (1-1000000)
- `price` - 价格 (0-1000)
- `rate` - 比率 (0-100%)
- `score` - 分数 (0-10)
- `temperature` - 温度 (-10-40)
- `latitude` - 纬度 (-90-90)
- `longitude` - 经度 (-180-180)

## 字段限制功能详解

### 功能说明
字段限制功能允许您为数字类型和日期类型字段设置最大值最小值，控制生成数据的范围。

### 使用方法
1. 在字段类型配置界面，数字/日期类型字段会显示"最小值""最大值"输入框
2. 填写需要的区间（如年龄最小18，最大65）
3. 点击"应用模板"，后端会根据区间生成数据

### 示例配置
```json
{
  "user_id": 0,
  "age": 0,
  "score": 0.0,
  "birth_date": ""
}
```

可以设置：
- `user_id`: 最小=1000, 最大=9999
- `age`: 最小=18, 最大=65
- `score`: 最小=0.0, 最大=100.0
- `birth_date`: 最小=1990-01-01 00:00:00

### 效果说明
- 生成的数据会严格落在设置的区间内
- 不设置时，使用默认范围（如年龄1-100，价格0-1000等）
- 日期类型只支持最小值限制，确保生成的日期不早于指定日期

## API接口使用

### 获取连接数
```bash
GET http://localhost:1883/api/connection-count
```
响应：
```json
{
  "count": 2
}
```

### 获取WebSocket信息
```bash
GET http://localhost:1883/api/websocket-info
```
响应：
```json
{
  "port": 1883,
  "path": "/",
  "url": "ws://localhost:1883/"
}
```

## 外部服务连接

### JavaScript示例
```javascript
const ws = new WebSocket('ws://localhost:1883/');
ws.onopen = function() {
    console.log('连接成功');
    // 发送JSON模板
    ws.send(JSON.stringify({
        template: {"id": 0, "name": ""},
        fieldTypes: {"id": "int", "name": "string"},
        fieldLimits: {"id": {"min": "1000", "max": "9999"}}
    }));
};
ws.onmessage = function(event) {
    console.log('收到数据:', event.data);
};
```

### Java示例
```java
WebSocketContainer container = ContainerProvider.getWebSocketContainer();
Session session = container.connectToServer(
    new WebSocketClient(), 
    new URI("ws://localhost:1883/")
);
```

### Python示例
```python
import websocket
ws = websocket.WebSocket()
ws.connect("ws://localhost:1883/")
```

## 故障排除

### 1. 端口被占用
如果1883端口被占用，修改 `application.properties`：
```properties
server.port=8080  # 改为其他可用端口
```

### 2. 连接失败
- 检查服务是否正常启动
- 确认端口是否正确
- 检查防火墙设置
- 查看浏览器控制台错误信息

### 3. 数据不推送
- 确保已建立WebSocket连接
- 确保已发送有效的JSON模板
- 检查模板格式是否正确
- 查看后端日志

### 4. 字段限制不生效
- 检查输入的最大最小值格式是否正确
- 数字类型输入纯数字（如：18, 65）
- 日期类型输入完整格式（如：1990-01-01 00:00:00）
- 确保字段类型选择正确

### 5. 编译错误
- 确认JDK版本为1.8
- 检查Maven版本
- 清理并重新编译：`.\mvnw.cmd clean compile`

## 日志查看

应用启动后，可以在控制台查看详细的运行日志：
- WebSocket连接日志
- 模板解析日志
- 数据生成日志
- 错误信息

## 扩展开发

### 1. 添加新的数据类型
在 `DynamicWebSocketServer.java` 类中的 `generateRandomByType` 方法中添加新的case分支。

### 2. 自定义字段限制逻辑
修改 `generateRandomInt`、`generateRandomDouble` 等方法，实现自定义的限制逻辑。

### 3. 实现定时推送
可以使用Spring的 `@Scheduled` 注解实现定时推送功能。

### 4. 数据库集成
可以集成数据库来存储和检索模板配置。

### 5. 安全认证
可以添加WebSocket连接的身份验证机制。

## 注意事项

1. 项目已配置为使用JDK 1.8，请确保开发环境使用正确的Java版本
2. WebSocket连接建立后需要发送JSON模板才能开始接收数据
3. 字段限制功能仅支持数字类型和日期类型
4. 支持多客户端同时连接，每个客户端可以有不同的模板配置
5. 如果客户端未发送模板，系统会在3秒后自动分配全局模板
6. 数组类型会生成1-3个随机元素
7. 嵌套对象和数组支持递归处理

## 联系支持

如有问题或建议，请查看项目日志或联系开发团队。 